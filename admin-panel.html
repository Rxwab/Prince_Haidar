<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prince Haidar | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f7f7f7;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .header-bg {
            background-color: #3b2820; /* Ø¨Ù†ÙŠ Ø¯Ø§ÙƒÙ† */
            color: #d4a761; /* Ø°Ù‡Ø¨ÙŠ */
        }
        .btn-primary {
            background-color: #d4a761; 
            color: #3b2820;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-primary:hover {
            background-color: #c09450;
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header-bg p-6 rounded-t-lg mb-8">
            <h1 class="text-3xl font-bold text-center">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Prince Haidar</h1>
            <p class="text-center text-gray-300 mt-2">Ø¥Ø¯Ø§Ø±Ø© ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù†ØµÙŠØ©</p>
        </header>

        <div id="status-message" class="p-4 text-center rounded-lg mb-6 hidden"></div>
        
        <div class="bg-gray-100 p-6 rounded-lg mb-8 border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub</h2>
            <div class="space-y-4">
                <div>
                    <label for="github-token" class="block text-gray-700 font-semibold mb-1">Ø±Ù…Ø² GitHub (Personal Access Token):</label>
                    <input type="password" id="github-token" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙˆÙƒÙ† Ù‡Ù†Ø§" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#d4a761]">
                    <p class="text-sm text-gray-500 mt-1">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ù„Ø±Ù…Ø² ØµÙ„Ø§Ø­ÙŠØ§Øª "repo" Ùˆ "workflow" Ù„Ù„Ø¹Ù…Ù„.</p>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <div class="p-6 border border-gray-300 rounded-lg shadow-md">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">1. Ù†Ø´Ø± ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ø¬Ø§ØªÙˆÙ‡ Ø£Ùˆ ÙƒØ¹ÙƒØ©)</h2>
                
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬:</label>
                    <div class="flex space-x-4 space-x-reverse">
                        <label class="inline-flex items-center">
                            <input type="radio" name="product-type" value="daily_pastries" checked class="form-radio text-[#d4a761]">
                            <span class="ml-2 text-gray-700">Ø¬Ø§ØªÙˆÙ‡ ÙŠÙˆÙ…ÙŠ</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="product-type" value="celebration_cakes" class="form-radio text-[#d4a761]">
                            <span class="ml-2 text-gray-700">ÙƒØ¹ÙƒØ© Ù…Ù†Ø§Ø³Ø¨Ø©</span>
                        </label>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="image-file" class="block text-gray-700 font-semibold mb-1">Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© (PNG/JPG):</label>
                    <input type="file" id="image-file" accept="image/*" 
                           class="w-full p-3 border border-gray-300 rounded-lg bg-white">
                </div>

                <div class="mb-6">
                    <label for="image-commit-message" class="block text-gray-700 font-semibold mb-1">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… (Commit Message):</label>
                    <input type="text" id="image-commit-message" value="Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#d4a761]">
                </div>

                <button onclick="uploadImage()" class="btn-primary w-full p-3 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    Ù†Ø´Ø± Ø§Ù„ØµÙˆØ±Ø©
                </button>
            </div>
            
            <div class="p-6 border border-gray-300 rounded-lg shadow-md">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">2. Ù†Ø´Ø± Ø¹Ø±Ø¶ Ù†ØµÙŠ Ø¬Ø¯ÙŠØ¯</h2>
                
                <div class="mb-4">
                    <label for="offer-text" class="block text-gray-700 font-semibold mb-1">Ù†Øµ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                    <textarea id="offer-text" rows="4" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ù‡Ù†Ø§ØŒ Ù…Ø«Ø§Ù„: Ø®ØµÙ… 20% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ ÙƒØ¹ÙƒØ§Øª Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©..."
                              class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#d4a761]"></textarea>
                </div>
                
                <div class="mb-6">
                    <label for="offer-commit-message" class="block text-gray-700 font-semibold mb-1">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… (Commit Message):</label>
                    <input type="text" id="offer-commit-message" value="Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ù†ØµÙŠ Ø¬Ø¯ÙŠØ¯"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#d4a761]">
                </div>

                <button onclick="publishTextOffer()" class="btn-primary w-full p-3 rounded-lg flex items-center justify-center">
                     <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                    Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØµÙŠ
                </button>
            </div>
        </div>
        
        <hr class="my-10 border-gray-300">

        <div class="p-6 border border-red-300 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2 text-red-600">3. Ø¥Ø¯Ø§Ø±Ø© (Ø­Ø°Ù) Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
            <div id="offers-list-container" class="space-y-4">
                 <p class="text-gray-500 text-center">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­Ø§Ù„ÙŠØ©...</p>
            </div>
             <div class="mt-4 text-center">
                <button onclick="loadCurrentOffers()" class="bg-gray-500 text-white font-semibold p-2 rounded-lg hover:bg-gray-600">
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                </button>
            </div>
        </div>


    </div>

    <script>
        // **********************************
        // ******* CONFIGURATION ************
        // **********************************
        const REPO_OWNER = 'YOUR_GITHUB_USERNAME'; // ØºÙŠÙ‘Ø± Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… GitHub Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const REPO_NAME = 'YOUR_REPO_NAME';       // ØºÙŠÙ‘Ø± Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Repo) Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const API_URL = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents`;
        const DATA_FILE_PATH = 'data.json';
        const IMAGE_FOLDER_PATH = 'assets/images';

        // **********************************
        // ********* HELPER FUNCTIONS *********
        // **********************************

        /**
         * FIX: Function to safely encode Arabic (UTF-8) content to Base64.
         * This solves the "contains characters outside of the Latin1 range" error.
         * @param {string} str - The UTF-8 string (e.g., JSON string with Arabic text).
         * @returns {string} Base64 encoded string.
         */
        function utf8ToBase64(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }
        
        // Function to decode Base64 to a readable UTF-8 string
        function base64ToUtf8(str) {
             return decodeURIComponent(escape(atob(str)));
        }


        // Display status message
        function displayStatus(message, isError = false) {
            const statusElement = document.getElementById('status-message');
            statusElement.textContent = message;
            statusElement.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'text-red-700', 'text-green-700');
            if (isError) {
                statusElement.classList.add('bg-red-100', 'text-red-700');
            } else {
                statusElement.classList.add('bg-green-100', 'text-green-700');
            }
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 8 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                statusElement.classList.add('hidden');
            }, 8000); 
        }

        // Get GitHub headers
        function getHeaders() {
            const token = document.getElementById('github-token').value;
            if (!token) {
                displayStatus('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² GitHub Ø§Ù„ØªÙˆÙƒÙ† Ø£ÙˆÙ„Ø§Ù‹.', true);
                return null;
            }
            return {
                'Authorization': `token ${token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/vnd.github.v3+json'
            };
        }

        // **********************************
        // ********* CORE API FUNCTIONS *********
        // **********************************

        /**
         * Get the current content and SHA of a file.
         * @param {string} filePath - Path to the file (e.g., 'data.json').
         * @returns {Promise<{content: string, sha: string} | null>} 
         */
        async function getFileContent(filePath) {
            const headers = getHeaders();
            if (!headers) return null;

            try {
                const response = await fetch(`${API_URL}/${filePath}`, { headers });
                if (response.status === 404) {
                     displayStatus(`ØªØ­Ø°ÙŠØ±: Ø§Ù„Ù…Ù„Ù ${filePath} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡.`, false);
                    return { content: null, sha: null };
                }
                if (!response.ok) {
                    throw new Error(`Failed to fetch file: ${response.statusText}`);
                }
                const data = await response.json();
                
                // Decode content using the safe function for Arabic characters
                const utf8Content = base64ToUtf8(data.content); 

                return {
                    content: utf8Content,
                    sha: data.sha
                };
            } catch (error) {
                console.error('GitHub API Error:', error);
                displayStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù: ${error.message}. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub ÙˆØ§Ù„ØªÙˆÙƒÙ†.`, true);
                return null;
            }
        }

        /**
         * Publish (Update or Create) a file on GitHub.
         * @param {string} filePath - Path to the file.
         * @param {string} content - The file content (Base64 for images, raw string for JSON/text).
         * @param {string} commitMessage - The commit message.
         * @param {string | null} sha - The current SHA of the file (required for update).
         * @param {boolean} isImage - If true, content is already Base64 and SHA is not needed for new file.
         * @returns {Promise<boolean>} Success status.
         */
        async function publishContent(filePath, content, commitMessage, sha = null, isImage = false) {
            const headers = getHeaders();
            if (!headers) return false;

            let contentBase64;
            
            if (isImage) {
                // Images are already Base64 data URLs, we extract the Base64 part
                contentBase64 = content.split(',')[1];
            } else {
                // Apply the FIX: Encode the UTF-8 string (JSON with Arabic) to Base64 safely
                contentBase64 = utf8ToBase64(content); 
            }

            const body = {
                message: commitMessage,
                content: contentBase64,
                sha: sha 
            };
            
            if (!sha && !isImage) {
                // If sha is null, it's a new file (create), SHA field is omitted.
                delete body.sha;
            }
            
            try {
                const response = await fetch(`${API_URL}/${filePath}`, {
                    method: sha ? 'PUT' : 'PUT', // Always PUT for update/create
                    headers: headers,
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || response.statusText);
                }
                
                // Get the updated SHA for subsequent calls if needed
                const updatedData = await response.json();
                return { success: true, sha: updatedData.content.sha };

            } catch (error) {
                console.error('GitHub API Error:', error);
                displayStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±: ${error.message}. Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆÙƒÙ† Ø£Ùˆ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©.`, true);
                return { success: false, sha: null };
            }
        }

        // **********************************
        // ***** IMAGE PUBLISHING LOGIC *****
        // **********************************

        async function uploadImage() {
            const fileInput = document.getElementById('image-file');
            const file = fileInput.files[0];
            const productType = document.querySelector('input[name="product-type"]:checked').value;
            const commitMessage = document.getElementById('image-commit-message').value;

            if (!file) {
                displayStatus('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹.', true);
                return;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                displayStatus('Ø®Ø·Ø£: Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 5 Ù…ÙŠØºØ§Ø¨Ø§ÙŠØª.', true);
                return;
            }

            displayStatus('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...', false);

            const reader = new FileReader();
            reader.readAsDataURL(file);

            reader.onload = async () => {
                const base64Data = reader.result;
                const fileExtension = file.name.split('.').pop();
                // Ø§Ø³Ù… ÙØ±ÙŠØ¯ Ù„Ù„ØµÙˆØ±Ø©
                const newImageFileName = `${productType}-${Date.now()}.${fileExtension}`; 
                const imagePath = `${IMAGE_FOLDER_PATH}/${newImageFileName}`;
                
                try {
                    // 1. Ù†Ø´Ø± Ø§Ù„ØµÙˆØ±Ø© Ù†ÙØ³Ù‡Ø§ ÙƒÙ…Ù„Ù Ù…Ù†ÙØµÙ„
                    const publishImageResult = await publishContent(imagePath, base64Data, commitMessage, null, true);
                    if (!publishImageResult.success) return; 

                    // 2. ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù data.json
                    displayStatus('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù data.json Ø¨Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©...', false);
                    const fileData = await getFileContent(DATA_FILE_PATH);
                    
                    let jsonContent;
                    if (fileData.content) {
                        jsonContent = JSON.parse(fileData.content);
                    } else {
                        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù JSON Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                        jsonContent = { daily_pastries: [], celebration_cakes: [], special_offers: [] };
                    }

                    // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ GitHub)
                    const rawUrl = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${imagePath}`;
                    jsonContent[productType].unshift(rawUrl); 

                    const updatedContent = JSON.stringify(jsonContent, null, 4);
                    
                    const updateJsonResult = await publishContent(DATA_FILE_PATH, updatedContent, `Add ${productType} image: ${newImageFileName}`, fileData.sha);
                    
                    if (updateJsonResult.success) {
                        displayStatus(`âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªØ­Ø¯ÙŠØ« data.json! Ø§Ù„Ø±Ø§Ø¨Ø·: ${rawUrl}`, false);
                    } else {
                        displayStatus('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù data.json.', true);
                    }

                } catch (error) {
                    displayStatus(`âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±: ${error.message}`, true);
                }
            };

            reader.onerror = () => {
                displayStatus('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©.', true);
            };
        }
        
        // **********************************
        // **** TEXT OFFER LOGIC (CRUD) *****
        // **********************************
        
        // --- 2. Ù†Ø´Ø± Ø¹Ø±Ø¶ Ù†ØµÙŠ Ø¬Ø¯ÙŠØ¯ ---
        async function publishTextOffer() {
            const offerText = document.getElementById('offer-text').value.trim();
            const commitMessage = document.getElementById('offer-commit-message').value.trim() || "Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ù†ØµÙŠ";

            if (!offerText) {
                displayStatus('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø¹Ø±Ø¶ Ø£ÙˆÙ„Ø§Ù‹.', true);
                return;
            }

            displayStatus('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù…Ù„Ù data.json ÙˆØªØ­Ø¯ÙŠØ«Ù‡...', false);
            
            try {
                const fileData = await getFileContent(DATA_FILE_PATH);
                if (!fileData) return;

                let jsonContent;
                if (fileData.content) {
                    jsonContent = JSON.parse(fileData.content);
                } else {
                    jsonContent = { daily_pastries: [], celebration_cakes: [], special_offers: [] };
                }

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµÙÙˆÙØ©
                jsonContent.special_offers.unshift(offerText); 
                
                const updatedContent = JSON.stringify(jsonContent, null, 4);
                
                const updateJsonResult = await publishContent(DATA_FILE_PATH, updatedContent, commitMessage, fileData.sha);
                
                if (updateJsonResult.success) {
                    displayStatus('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªØ­Ø¯ÙŠØ« data.json!', false);
                    document.getElementById('offer-text').value = ''; // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
                    loadCurrentOffers(); // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù
                } else {
                    displayStatus('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù data.json.', true);
                }

            } catch (error) {
                displayStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© JSON: ${error.message}.`, true);
            }
        }
        
        // --- 3. Ø­Ø°Ù Ø¹Ø±Ø¶ Ù†ØµÙŠ ---
        async function deleteTextOffer(index) {
            const commitMessage = `Ø­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØµÙŠ Ø±Ù‚Ù… ${index + 1}`;
            
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶ Ø±Ù‚Ù… ${index + 1}ØŸ`)) return;

            displayStatus('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù…Ù„Ù data.json ÙˆØ­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶...', false);
            
            try {
                const fileData = await getFileContent(DATA_FILE_PATH);
                if (!fileData) return;

                let jsonContent = JSON.parse(fileData.content);
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† special_offers Ù…ØµÙÙˆÙØ© ÙˆØºÙŠØ± ÙØ§Ø±ØºØ©
                if (!Array.isArray(jsonContent.special_offers) || jsonContent.special_offers.length <= index) {
                    displayStatus('Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­Ø°ÙÙ‡.', true);
                    return;
                }
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
                jsonContent.special_offers.splice(index, 1); 
                
                const updatedContent = JSON.stringify(jsonContent, null, 4);
                
                const updateJsonResult = await publishContent(DATA_FILE_PATH, updatedContent, commitMessage, fileData.sha);
                
                if (updateJsonResult.success) {
                    displayStatus('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­!', false);
                    loadCurrentOffers(); // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù
                } else {
                    displayStatus('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶ Ù…Ù† data.json.', true);
                }

            } catch (error) {
                displayStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© JSON: ${error.message}.`, true);
            }
        }

        // --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ù„Ù„Ø­Ø°Ù ---
        async function loadCurrentOffers() {
            const container = document.getElementById('offers-list-container');
            container.innerHTML = '<p class="text-gray-500 text-center">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶...</p>';
            
            const fileData = await getFileContent(DATA_FILE_PATH);
            if (!fileData || !fileData.content) {
                container.innerHTML = '<p class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù†ØµÙŠØ© Ù…Ù†Ø´ÙˆØ±Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>';
                return;
            }

            try {
                const jsonContent = JSON.parse(fileData.content);
                const offers = Array.isArray(jsonContent.special_offers) ? jsonContent.special_offers : [];

                if (offers.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù†ØµÙŠØ© Ù…Ù†Ø´ÙˆØ±Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>';
                    return;
                }

                container.innerHTML = ''; // Ù…Ø³Ø­ Ø±Ø³Ø§Ù„Ø© "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„"
                offers.forEach((offer, index) => {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù„ÙƒÙ„ Ø¹Ø±Ø¶ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø­Ø°Ù
                    const offerElement = document.createElement('div');
                    offerElement.className = 'flex items-center justify-between p-3 border border-red-200 bg-red-50 rounded-lg';
                    offerElement.innerHTML = `
                        <p class="text-gray-700 font-semibold flex-grow">${index + 1}. ${offer}</p>
                        <button onclick="deleteTextOffer(${index})" 
                                class="bg-red-500 text-white text-sm font-bold py-1 px-3 rounded-lg hover:bg-red-600 transition duration-200 flex items-center flex-shrink-0 ml-4">
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            Ø­Ø°Ù Ø§Ù„Ø¹Ø±Ø¶ ğŸ—‘ï¸
                        </button>
                    `;
                    container.appendChild(offerElement);
                });

            } catch (error) {
                 container.innerHTML = `<p class="text-red-500 text-center">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù data.json: ${error.message}</p>`;
            }
        }


        // **********************************
        // ******* INITIALIZATION ***********
        // **********************************
        document.addEventListener('DOMContentLoaded', () => {
             // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
             loadCurrentOffers();
        });
    </script>
</body>
</html>
