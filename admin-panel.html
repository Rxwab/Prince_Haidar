<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø³Ø±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #2c2c2c;
            color: #f7f7f7;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .accent-color {
            color: #d4a761; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        }
        .btn-gold {
            background-color: #d4a761;
            color: #3b2820;
            transition: background-color 0.3s ease;
        }
        .btn-gold:hover {
            background-color: #bfa05d;
        }
        .dark-bg-input {
            background-color: #3b2820; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¨Ù†ÙŠ Ø§Ù„Ø¯Ø§ÙƒÙ† */
        }
    </style>
</head>
<body>
    
    <div class="bg-gray-800 rounded-xl shadow-2xl p-8 w-full max-w-xl transform transition-all duration-300 scale-100">
        
        <h1 class="text-4xl font-bold text-red-500 mb-8 text-center border-b border-gray-700 pb-3">
            Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù†Ø´Ø± (Admin Panel)
        </h1>
        
        <p class="text-sm text-yellow-400 mb-6 text-center">
            ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø´Ø±.
        </p>

        <div class="mb-4">
            <label for="image-url" class="block text-white text-lg mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (URL):</label>
            <input type="url" id="image-url" placeholder="https://i.ibb.co/..." class="w-full p-3 rounded-lg dark-bg-input text-white border border-gray-600 focus:ring-accent-color focus:border-accent-color">
        </div>

        <div class="mb-6">
            <label for="github-token" class="block text-white text-lg mb-2">Ø±Ù…Ø² GitHub (Token):</label>
            <input type="password" 
                   id="github-token" 
                   value="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" 
                   placeholder="Ø§Ù„ØµÙ‚ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø´Ø®ØµÙŠ Ù‡Ù†Ø§ (Ù…Ø«Ù„ ghp_...)" 
                   class="w-full p-3 rounded-lg dark-bg-input text-white border border-gray-600 focus:ring-accent-color focus:border-accent-color">
            <p class="text-xs text-red-400 mt-2">
                *Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø¬Ø§Ù‡Ø² Ø§Ù„Ø¢Ù†.
            </p>
        </div>
        
        <button onclick="publishNewImage()" class="btn-gold px-8 py-3 text-xl font-bold rounded-xl shadow-xl w-full">
            ğŸš€ Ù†Ø´Ø± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¢Ù† 
        </button>
        
        <p id="publish-status" class="text-center mt-4 text-white h-6 font-bold"></p>

        <div class="mt-8 pt-4 border-t border-gray-700">
            <h4 class="text-xl accent-color mb-3">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø± (Ù…Ø¹Ø¯Ù„Ø© Ù„Ø­Ø³Ø§Ø¨Ùƒ):</h4>
            <div class="space-y-2 text-sm text-gray-400">
                <p><strong>Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Owner):</strong> <span id="display-owner">Rxwab</span></p>
                <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Repo):</strong> <span id="display-repo">Prince_Haidar</span></p>
                <p><strong>Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> <span>data.json</span></p>
            </div>
        </div>
    </div>

    <script>
        // ** ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªÙ†Ø§Ø³Ø¨ Ø­Ø³Ø§Ø¨Ùƒ 'Rxwab' ÙˆØ§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ 'Prince_Haidar' **
        const REPO_OWNER = 'Rxwab';  
        const REPO_NAME = 'Prince_Haidar'; 
        const DATA_FILE_PATH = 'data.json';
        const BRANCH_NAME = 'main'; 

        // Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        document.getElementById('display-owner').textContent = REPO_OWNER;
        document.getElementById('display-repo').textContent = REPO_NAME;

        /**
         * ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Base64 (Ù…Ø·Ù„ÙˆØ¨ Ù„Ù€ GitHub API)
         */
        function toBase64(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        /**
         * ÙŠÙ†Ø´Ø± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ù† Ø·Ø±ÙŠÙ‚ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„Ù data.json Ø¹Ù„Ù‰ GitHub
         */
        async function publishNewImage() {
            const imageUrl = document.getElementById('image-url').value;
            const token = document.getElementById('github-token').value;
            const statusElement = document.getElementById('publish-status');
            
            statusElement.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ GitHub...';
            statusElement.className = 'text-center mt-4 text-yellow-400 h-6 font-bold';

            if (!imageUrl || !token) {
                statusElement.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ.';
                statusElement.className = 'text-center mt-4 text-red-500 h-6 font-bold';
                return;
            }

            const API_URL = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${DATA_FILE_PATH}`;

            try {
                // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHAØŒ ÙˆÙ‡Ùˆ Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)
                let response = await fetch(API_URL, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.com.v3+json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù: ${response.status} - ${response.statusText}`);
                }

                const fileData = await response.json();
                const currentContentBase64 = fileData.content;
                const currentSHA = fileData.sha;

                // ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const currentContentJson = JSON.parse(atob(currentContentBase64));
                currentContentJson.published_images.push(imageUrl); 
                
                // ØªØ±Ù…ÙŠØ² Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ù„Ù‰ Base64
                const newContentString = JSON.stringify(currentContentJson, null, 2);
                const newContentBase64 = toBase64(newContentString);

                // 2. Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (PUT)
                const putBody = JSON.stringify({
                    message: `Added new image via Admin Panel: ${new Date().toISOString()}`,
                    content: newContentBase64,
                    sha: currentSHA, // Ù†Ø±Ø³Ù„ SHA Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø¥Ø«Ø¨Ø§Øª Ø£Ù†Ù†Ø§ Ù†Ø¹Ø¯Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù
                    branch: BRANCH_NAME
                });

                response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.com.v3+json'
                    },
                    body: putBody
                });

                if (!response.ok) {
                    throw new Error(`ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±: ${response.status} - ${response.statusText}`);
                }

                statusElement.textContent = 'âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­! Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø¸Ù‡ÙˆØ± Ø§Ù„ØµÙˆØ±Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹.';
                statusElement.className = 'text-center mt-4 text-green-500 h-6 font-bold';
                document.getElementById('image-url').value = ''; 
                // Ù†ØªØ±Ùƒ Ø§Ù„ØªÙˆÙƒÙ† ÙƒÙ…Ø§ Ù‡Ùˆ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©

            } catch (error) {
                console.error('GitHub API Error:', error);
                statusElement.textContent = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±: ${error.message}. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.`;
                statusElement.className = 'text-center mt-4 text-red-500 h-6 font-bold';
            }
        }
    </script>
</body>
  </html>
